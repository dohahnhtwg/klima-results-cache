<link rel="import" href="../polymer/polymer.html">

<!--
`klima-results-cache`
Fetches result from Klima server and prepares data for views

@demo demo/index.html
-->

<dom-module id="klima-results-cache">

  <script>
  Polymer({
    is: 'test-ele',
    properties: {
      allocationData: Object,
      contributionMargin: Object,
      fullCosts: Object,
      periodResults: Object,
      personal: Object,
      arrivalRates: Object,
      qualities: Object
    },

    ready: function() {

    },

    getChartData: function(domainName, departmentName, valueOfInterest, callback) {
      var department = this[domainName][departmentName];
      if(!department) {
        this.$.ajax.url = "something";
        this.$.ajax.response = function(e) {
          allocationData[department] = e.result.data;
          var chartData = this.buildChartData(department, valueOfInterest);
          callback(chartData);
        }
        this.$.ajax.generateRequest();
      } else {
        var chartData = this.buildChartData(department, valueOfInterest);
        callback(chartData);
      }
    },

    buildChartData: function(department, valueOfInterest, columns) {
      var rows = new Array();
      department.foreach(function(periodResults) {
        var valueOfInterestResult = periodResults.foreach(function(value) {
            return value.id == valueOfInterest;
        });
        var row = new Array();
        columns.foreach(function(column) {
          row.push(valueOfInterestResult[column]);
        });
        rows.push(row);
      });
      return rows;
    }

  })
  </script>
</dom-module>
