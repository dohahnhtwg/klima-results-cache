<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>klima-results-cache test</title>

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <link rel="import" href="test-element.html">
  </head>
  <body>
    <test-fixture id="basic">
      <template>
        <test-element></test-element>
      </template>
    </test-fixture>

    <script>
      var server = null;
      setup(function() {
        server = sinon.fakeServer.create();
        server.respondWith('GET', /.*/, [200, {'Content-Type': 'application/json'},
          JSON.stringify(allocationData)
        ])
      });
      suite('klima-results-cache', function() {
        test('instantiating the element works', function() {
          var elem = fixture("basic");
        });
        test('getChartData should build and return data for the chart', function(done) {
          var elem = fixture('basic');
          elem.getChartData('arrivedPatients', 'allocationData', 'total', function(chartData) {
            console.log(chartData);
            expect(chartData.cols).to.have.lengthOf(4);
            expect(chartData.cols[1].color).to.be.equal('#f44336');
            expect(chartData.cols[1].id).to.be.equal('internal');
            expect(chartData.cols[1].label).to.be.equal('Innere Medizin');
            expect(chartData.cols[1].type).to.be.equal('number');
            expect(chartData.rows).to.have.lengthOf(1);
            expect(chartData.rows[0]).to.have.lengthOf(4);
            expect(chartData.rows[0][0]).to.be.equal("0");
            expect(chartData.rows[0][1]).to.be.equal(440);
            expect(chartData.rows[0][2]).to.be.equal(700);
            expect(chartData.rows[0][3]).to.be.equal(300);
            done();
          });
          server.respond();
        });
      });
    </script>
    <script>
      var allocationData = {"caption":"Belegungsdaten",
        "key":"allocationData",
        "departmentResults":[
          {
            "caption":"Gesamtes Krankenhaus",
            "key":"total",
            "periodResults":[
              {
                "rows":[
                  {
                    "caption":"Belegungsgrad",
                    "key":"occupancyLevel",
                    "isMerged":false,
                    "values":[
                      "1.0",
                      "1.0",
                      "1.0"
                    ]
                  },
                  {
                    "caption":"Angekommene Patienten",
                    "key":"arrivedPatients",
                    "isMerged":false,
                    "values":[
                      "440",
                      "700",
                      "300"
                    ]
                  }
                ],
                "columns":[
                   {
                      "caption":"Innere Medizin",
                      "key":"internal"
                   },
                   {
                      "caption":"Chirurgie",
                      "key":"surgery"
                   },
                   {
                      "caption":"GynÃ¤kologie",
                      "key":"gynecology"
                   }
                ]
              }
            ]
          }, {
            "caption":"Innere Medizin",
            "key":"internalMedicine",
            "periodResults":[]
          }
        ]
      }
    </script>
  </body>
</html>
